#!/usr/bin/env bash

if [ _${BUILD_SYSTEM} != _"$(dirname "$(dirname "$(greadlink -f "$0")")")" ] ; then
  . "$(dirname "$(dirname "$(greadlink -f "$0")")")"/.variables
fi

clean=false
configure=false

while [ _"$1" != _ ]; do
  case $1 in
  --clean)
    clean=true
    ;;
  
  --configure)
    configure=true
    ;;
  esac
 
  shift
done

echo ${LOG_DIR}/install-dependencies
[ -f ${LOG_DIR}/install-dependencies ] && rm ${LOG_DIR}/install-dependencies

export BUILD_DIR="${BUILD_DIR}/copasi-dependencies"
[ -e "${BUILD_DIR}" ] || mkdir -p "${BUILD_DIR}"

cd ${BUILD_DIR}

if [ ${configure} = true -o ! -e CMakeCache.txt ]; then
    rm -rf * .cmake

    echo cmake -G Ninja \
          -DBUILD_clapack=OFF \
          -DBUILD_qwtplot3d=off \
          -DBUILD_NativeJIT=OFF \
          -DCMAKE_INSTALL_PREFIX=${INSTALL_DIR} \
          -DCMAKE_BUILD_TYPE=${BUILD_TYPE} \
          -DSELECT_QT=${SELECT_QT} \
          ${BUILD_SYSTEM}/git/copasi-dependencies

    cmake -G Ninja \
          -DBUILD_clapack=OFF \
          -DBUILD_qwtplot3d=off \
          -DBUILD_NativeJIT=OFF \
          -DCMAKE_INSTALL_PREFIX=${INSTALL_DIR} \
          -DCMAKE_BUILD_TYPE=${BUILD_TYPE} \
          -DSELECT_QT=${SELECT_QT} \
          ${BUILD_SYSTEM}/git/copasi-dependencies 2>&1 | tee "${LOG_DIR}/install-dependencies"
fi

if [ ${clean} = true ]; then
    ninja clean
fi

ninja 2>&1 | tee "${LOG_DIR}/install-dependencies"
