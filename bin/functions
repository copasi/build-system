#!/usr/bin/env bash

export BUILD_ROOT="$(dirname "$(dirname "$(readlink -f "$BASH_SOURCE")")")"
export AWK=${expo:-gawk}

function isCygwin() {
  uname -a | grep -qi cygwin
}

function isDarwin() {
  uname -a | grep -qi darwin
}

function convertPath() {
  isCygwin \
    && cygpath -w "$1" \
    || echo "$1" 
}

function create() {
  isCygwin \
    && cmd="${COPASI_SOURCES}/InnoSetup/create.sh" \
    || isDarwin \
      && cmd="${COPASI_SOURCES}/PackageMaker/create.sh" \
      || cmd="${COPASI_SOURCES}/LinuxTGZ/create.sh"

  echo ${cmd} $1 
  ${cmd} $1 
}

function version() {
  export major=`${AWK} -- '$2 ~ "COPASI_VERSION_MAJOR" {print $3}' "${COPASI_SOURCES}/copasi/CopasiVersion.h"`
  export minor=`${AWK} -- '$2 ~ "COPASI_VERSION_MINOR" {print $3}' "${COPASI_SOURCES}/copasi/CopasiVersion.h"`
  export build=`${AWK} -- '$2 ~ "COPASI_VERSION_BUILD" {print $3}' "${COPASI_SOURCES}/copasi/CopasiVersion.h"`
  export modified=`${AWK} -- '$2 ~ "COPASI_VERSION_MODIFIED" {print $3}' "${COPASI_SOURCES}/copasi/CopasiVersion.h"`
  export comment=`${AWK} -- '$2 ~ "COPASI_VERSION_COMMENT" {print $3}' "${COPASI_SOURCES}/copasi/CopasiVersion.h"`

  export sourceVersion=${major}.${minor}.${build}
  targetVersion=$sourceVersion

  if [ $modified == true ]; then
    targetVersion=${targetVersion}+
  fi

  export targetVersion
}

isCygwin \
  && . ${BUILD_ROOT}/bin/functions.windows \
  || isDarwin \
    && . ${BUILD_ROOT}/bin/functions.darwin \
    || . ${BUILD_ROOT}/bin/functions.linux
