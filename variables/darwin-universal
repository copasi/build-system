#!/usr/bin/env bash

initializeDirs

if [ _${MACOSX_DEPLOYMENT_TARGET} != _12.0 ]; then
  export CC=clang
  export CXX=clang++
  export MACOSX_DEPLOYMENT_TARGET=12.0
  export SDK=/Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX.sdk
  export ARCHITECTURES=arm64

  export Qt6_DIR=$HOME_BUILD_SYSTEM/6.8.2/macos
  export PATH=$HOME_BUILD_SYSTEM/6.8.2/macos/bin/:$PATH
  export SELECT_QT=Qt6
  export QTDIR=$HOME_BUILD_SYSTEM/6.8.2/macos

  export PATH="${QTDIR}/bin:${QTDIR}/libexec:/Library/Frameworks/Mono.framework/Versions/Current/bin:${PATH}"

  export JAVA_HOME=$(ls -d /opt/homebrew/opt/openjdk*/ | head -n 1)
  export java_include="${JAVA_HOME}/include"
  export java_lib="${JAVA_HOME}/libexec/openjdk.jdk/Contents/Home/lib/"

  export PKG_CONFIG_PATH="${INSTALL_DIR}/lib/pkgconfig:${PKG_CONFIG_PATH}"

  export BUILD_TOOL="ninja"
  export SWIG_EXECUTABLE=$(which swig)

  COMMON_CMAKE_OPTIONS="-G;Ninja"
  COMMON_CMAKE_OPTIONS="${COMMON_CMAKE_OPTIONS};-DCMAKE_BUILD_TYPE=${BUILD_TYPE:-Release}"
  COPASI_CMAKE_OPTIONS="${COPASI_CMAKE_OPTIONS};-DENABLE_JAVA=ON"
  COMMON_CMAKE_OPTIONS="${COMMON_CMAKE_OPTIONS};-DSELECT_QT=${SELECT_QT}"
  COMMON_CMAKE_OPTIONS="${COMMON_CMAKE_OPTIONS};-DCMAKE_OSX_ARCHITECTURES=${ARCHITECTURES}"
  COMMON_CMAKE_OPTIONS="${COMMON_CMAKE_OPTIONS};-DCMAKE_OSX_DEPLOYMENT_TARGET=${MACOSX_DEPLOYMENT_TARGET}"
  COMMON_CMAKE_OPTIONS="${COMMON_CMAKE_OPTIONS};-DCMAKE_OSX_SYSROOT=${SDK}"
  COMMON_CMAKE_OPTIONS="${COMMON_CMAKE_OPTIONS};-DCMAKE_CXX_FLAGS=-Wno-inconsistent-missing-override"
  export COMMON_CMAKE_OPTIONS

  COPASI_CMAKE_OPTIONS="-DENABLE_JIT=OFF"
  COPASI_CMAKE_OPTIONS="${COPASI_CMAKE_OPTIONS};-DENABLE_JAVA=ON"
  COPASI_CMAKE_OPTIONS="${COPASI_CMAKE_OPTIONS};-DENABLE_CSHARP=ON"
  COPASI_CMAKE_OPTIONS="${COPASI_CMAKE_OPTIONS};-DSWIG_EXECUTABLE=${SWIG_EXECUTABLE}"
  COPASI_CMAKE_OPTIONS="${COPASI_CMAKE_OPTIONS};-DJAVA_COMPATIBILITY=1.8"
  COPASI_CMAKE_OPTIONS="${COPASI_CMAKE_OPTIONS};-DJAVA_INCLUDE_PATH=${java_include}"
  COPASI_CMAKE_OPTIONS="${COPASI_CMAKE_OPTIONS};-DJAVA_INCLUDE_PATH2=${java_include}"
  COPASI_CMAKE_OPTIONS="${COPASI_CMAKE_OPTIONS};-DJAVA_AWT_INCLUDE_PATH=${java_include}"
  COPASI_CMAKE_OPTIONS="${COPASI_CMAKE_OPTIONS};-DJAVA_JVM_LIBRARY=${java_lib}/server/libjvm.dylib"
  COPASI_CMAKE_OPTIONS="${COPASI_CMAKE_OPTIONS};-DJAVA_AWT_LIBRARY=${java_lib}/libawt.dylib"
  COPASI_CMAKE_OPTIONS="${COPASI_CMAKE_OPTIONS};-DCOPASI_USE_QCUSTOMPLOT=ON"
  COPASI_CMAKE_OPTIONS="${COPASI_CMAKE_OPTIONS};-DQt6Widgets_UIC_EXECUTABLE=${QTDIR}/libexec/uic"
  COPASI_CMAKE_OPTIONS="${COPASI_CMAKE_OPTIONS};-DWITH_DATAVISUALIZATION_NAMESPACES=OFF"
  export COPASI_CMAKE_OPTIONS

  DEPENDENCIES_CMAKE_OPTIONS="-DCMAKE_INSTALL_PREFIX=$(convertPath ${INSTALL_DIR})"
  DEPENDENCIES_CMAKE_OPTIONS="${DEPENDENCIES_CMAKE_OPTIONS};-DBUILD_zlib=ON"
  DEPENDENCIES_CMAKE_OPTIONS="${DEPENDENCIES_CMAKE_OPTIONS};-DBUILD_clapack=OFF"
  DEPENDENCIES_CMAKE_OPTIONS="${DEPENDENCIES_CMAKE_OPTIONS};-DBUILD_NativeJIT=OFF"
  DEPENDENCIES_CMAKE_OPTIONS="${DEPENDENCIES_CMAKE_OPTIONS};-DBUILD_qwtplot3d=OFF"
  export DEPENDENCIES_CMAKE_OPTIONS
fi
