#!/usr/bin/env bash

OLD_BUILD_SYSTEM="${BUILD_SYSTEM}"
BUILD_SYSTEM="${BUILD_ROOT}/$(basename "$(${COPASI_READLINK:-readlink} -f "$BASH_SOURCE")")"

if [ _${OLD_BUILD_SYSTEM} != _${BUILD_SYSTEM} ]; then
  export BUILD_SYSTEM
  . ${BUILD_ROOT}/variables/vs-2017-64

  export BUILD_TOOL=ninja

  COMMON_CMAKE_OPTIONS="-G;Ninja"
  COMMON_CMAKE_OPTIONS="${COMMON_CMAKE_OPTIONS};-DCMAKE_BUILD_TYPE=${BUILD_TYPE:-Release}"
  COMMON_CMAKE_OPTIONS="${COMMON_CMAKE_OPTIONS};-DWITH_STATIC_RUNTIME=OFF"
  COMMON_CMAKE_OPTIONS="${COMMON_CMAKE_OPTIONS};-DSELECT_QT=${SELECT_QT}"
  COMMON_CMAKE_OPTIONS="${COMMON_CMAKE_OPTIONS};-DWITH_DATAVISUALIZATION_NAMESPACES=ON"
  COMMON_CMAKE_OPTIONS="${COMMON_CMAKE_OPTIONS};-DCMAKE_CXX_USE_RESPONSE_FILE_FOR_OBJECTS=1"
  COMMON_CMAKE_OPTIONS="${COMMON_CMAKE_OPTIONS};-DCMAKE_CXX_RESPONSE_FILE_LINK_FLAG=\"@\""
  export COMMON_CMAKE_OPTIONS

  COPASI_CMAKE_OPTIONS="-DBUILD_SE=OFF"
  COPASI_CMAKE_OPTIONS="${COPASI_CMAKE_OPTIONS};-DF2C_INTEGER=int"
  COPASI_CMAKE_OPTIONS="${COPASI_CMAKE_OPTIONS};-DCOPASI_USE_QCUSTOMPLOT=ON"
  COPASI_CMAKE_OPTIONS="${COPASI_CMAKE_OPTIONS};-DENABLE_JAVA=ON"
  COPASI_CMAKE_OPTIONS="${COPASI_CMAKE_OPTIONS};-DENABLE_CSHARP=ON"
  COPASI_CMAKE_OPTIONS="${COPASI_CMAKE_OPTIONS};-DSWIG_EXECUTABLE=${SWIG_EXECUTABLE}"
  COPASI_CMAKE_OPTIONS="${COPASI_CMAKE_OPTIONS};-DENABLE_JIT=ON"
  COPASI_CMAKE_OPTIONS="${COPASI_CMAKE_OPTIONS};-DISABLE_STACK_PROTECTOR=ON"
  export COPASI_CMAKE_OPTIONS

  DEPENDENCIES_CMAKE_OPTIONS="-DCMAKE_INSTALL_PREFIX=$(convertPath ${INSTALL_DIR})"
  DEPENDENCIES_CMAKE_OPTIONS="${DEPENDENCIES_CMAKE_OPTIONS};-DBUILD_clapack=OFF"
  DEPENDENCIES_CMAKE_OPTIONS="${DEPENDENCIES_CMAKE_OPTIONS};-DBUILD_NativeJIT=ON"
  DEPENDENCIES_CMAKE_OPTIONS="${DEPENDENCIES_CMAKE_OPTIONS};-DBUILD_qwtplot3d=OFF"
  export DEPENDENCIES_CMAKE_OPTIONS
fi
